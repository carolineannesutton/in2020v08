---
title: "IN2020V08"
author: "Caroline Sutton"
date: "17/12/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyr)
library(tidyverse)
library(dplyr)
library(knitr)

# read in data
ccomp <- read_csv("data/in2020_v08_samples.csv")
length <- read_csv("data/IN2020_V08_Lengths_tidy.csv")
Shot <- read_csv("data/IN2020_V08_ShotData.csv")
```

```{r Length Data}

# change to uniform names for 'deployment' and 'Accession number' and match species names in length data
ccomp_1 <- ccomp %>% 
  rename(Deployment = 'Operation No', Acc = 'Accession No')

length_1 <- length %>% 
  rename(Acc = 'Acc #') %>% 
  left_join(ccomp_1, by = c("Deployment", "Acc"))
  


```

RMT 16 net area = 16m^2
speed of vessel on average  = 1kt *** but check with Grafana
time of tow = mins
conversion of kts to kph = kts * 1.852 (kph)
conversion of kph to mpm= kph * 16.667 (mpm)
volume filtered (m^3)= distance (m)* net mouth area (m^2) = ((speed (m/min) * time towed (min)) * net area (m^2))
```{r volume filtered calculation}
Shot_1 <- Shot %>% 
  filter(Category== "Start" | Category == "Stop") %>% 
   select(-Date,-Depth,-'Sea Water Temperature', -Author, - 'Op owner')%>%
  #change Latitude to Decimal degrees
  mutate(Lat = Latitude) %>% 
  separate(Lat, c("deg","min","dir"),sep = " ") %>% 
  mutate(deg = as.numeric(deg)) %>% 
  mutate(dir = as.numeric(dir)) %>% 
  mutate(lat_decdeg = deg + dir/60) %>% 
#change longitude to decimal degrees
mutate(Long = Longitude) %>% 
  separate(Long, c("ldeg","lmin","ldir"),sep = " ") %>% 
  mutate(ldeg = as.numeric(ldeg)) %>% 
  mutate(ldir = as.numeric(ldir)) %>% 
  mutate(long_decdeg = ldeg + ldir/60) %>% 
  select(-deg,-min,-dir,-ldeg,-lmin,-ldir)
 


start <- Shot_1 %>% 
  filter(Category == "Start")
stop <- Shot_1 %>% 
  filter(Category =="Stop") %>% 
  select('Op number', lat_decdeg,long_decdeg,Location,`Real Date`) 


Shot_2 <- start %>% 
 left_join(stop, by = 'Op number', suffix= c("_start", "_stop")) %>% 
  select(-Category, Site=Location_start, Net_Name = Type, Depth_Stratum = Subject,
         Deployment = 'Op number') %>% 
  separate(Depth_Stratum,c("Depth_Stratum","daylight"),sep = " ") %>% 
  mutate(Speed_mpm = 1*1.852*16.667) %>% 
  mutate(TowDuration_mins = ifelse(Depth_Stratum =="Lmeso",120,
                                   ifelse(Depth_Stratum =="Meso", 40,
                                          ifelse(Depth_Stratum=="Epi",40,
                                                 ifelse(Depth_Stratum =="'Trawl Site - Marine Park'", 80,
                                                        20))))) %>% 
  mutate(distance_m = Speed_mpm * TowDuration_mins) %>% 
  mutate(VolumeFiltered_m3 = distance_m * 16)
  


                                   
                                   
                                  
 

  #calculate distance from position

write.csv(Shot_2,"Results/shotdata.csv")
 
`

spread by start stop


Shot_3 <- Shot_2 %>% 
  mutate(Speed_kph = 1*1.852) %>% 
  mutate(TowDuration_mins = ifelse(stratum =="Lmeso",120,40)) %>% 
  # volume filtered = distance * net mouth area = ((speed * time towed) * net area)
  mutate(distance_spd = 1 * 16.667*TowDuration_mins) 


  mutate(VF_spd= distance_spd*16)
#mutate(VolumeFiltered_spd =  (* 1 * 16))
    
    
```{r spread the shot data}

shot_2 <- Shot_1 %>% 
  select(-Depth,-'Sea Water Temperature', -Author, - 'Op owner')
    #pivot_wider(names_from = Category,values_from = c(Latitude, Longitude,'Real Date'))
start <- shot_2 %>% 
  filter(Category == "Start")
stop <- shot_2 %>% 
  filter(Category =="Stop") %>% 
  select('Op number', Latitude,Longitude,Location,`Real Date`)
Shot_3 <- start %>% 
 left_join(stop, by = 'Op number', suffix= c("_start", "_stop"))
```

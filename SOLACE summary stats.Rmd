---
title: "Summary data"
author: "sutton"
date: "24/09/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(Rmisc)
library(lattice)
library(tidyr)
library(tidyverse)
library(gridExtra)
library(dplyr)
library(knitr)
library(geosphere)
library(janitor)


SOLACE <- read_csv("Results/IN2020_V08_CatchComp.csv")

SOLACE_nogel <- SOLACE %>% 
  #distinct(Acoustic_Category)
  filter(Acoustic_Category != "G_nGB")
```


```{r cummulative biomass}

SOLACE_Micro <- SOLACE_Micro %>% 
  filter(Site == "55S" | Site == "58S" |Site == "SOTS") %>% 
  filter(Depth_Stratum =="Meso" | Depth_Stratum == "Epi"|Depth_Stratum=="Lmeso") %>% 
  drop_na(Site)

distinct(SOLACE_Micro,Depth_Stratum)

SOLACE_Micro_1 <- SOLACE_Micro %>% 
  select(Site,Acoustic_Category,Taxa_updated,weight_g) %>% 
  group_by(Site,Taxa_updated) %>% 
  summarise(weight = sum(weight_g))

  ungroup() %>% 
  arrange(Site,-weight) %>% 
  #mutate(cumsum = cumsum(weight)) %>% 
  #mutate(cumpercent = cumsum/sum(weight)) %>% 
  mutate(percent =round(weight/sum(weight),2)) 
```

```{r cumsum}
  
  SOLACE_1 <- SOLACE %>% 
  select(Site,Acoustic_Category,Taxa_updated,weight_g) %>% 
  dplyr::group_by(Site,Taxa_updated) %>% 
  dplyr::summarise(weight = sum(weight_g)) %>% 
  arrange(Site,-weight) %>% 
  mutate(cumsum = cumsum(weight)) %>% 
  mutate(cumpercent = cumsum/sum(weight)) %>% 
  mutate(percent =round(weight/sum(weight),2)) 
```

```{r sum biomass by deployment}
BulkBiomass <- SOLACE %>% 
  select(Site, daylight,Depth_Stratum, Deployment, Taxa_updated,Acoustic_Category, Abd_Std_nosm3_sp,Weight_Std_gm3_sp) %>%
  dplyr::group_by(Site, daylight, Depth_Stratum,Deployment) %>% 
  dplyr::summarise(Weight = round(sum(Weight_Std_gm3_sp)*1000,2), abd = round(sum(Abd_Std_nosm3_sp)*1000,2)) %>% 
  dplyr::ungroup()



  
SOLACE %>% 
  distinct(Acoustic_Category)
```
```{r summary stats}
BulkBiomass$Depth_Stratum <- factor(as.factor(BulkBiomass$Depth_Stratum), levels=c("Lmeso","Meso","Epi"))
BulkBiomass$Site <- factor(as.factor(BulkBiomass$Site), levels=c("SOTS","55S","58S"))
BulkBiomass$daylight <- factor(as.factor(BulkBiomass$daylight), levels=c("Day","Night"))

BulkBiomass %>% 
  group_by(Site, daylight, Depth_Stratum) %>% 
  get_summary_stats(Weight, type = "mean_sd")
```
boxplot
```{r boxplot}
bxp <- ggboxplot(
  BulkBiomass, x = "daylight", y = "Weight", 
  color = "Depth_Stratum", palette = "jco", facet.by = "Site"
  )
bxp
```


outliers
```{r outliers}
BulkBiomass %>%
  group_by(Site, daylight, Depth_Stratum) %>%
  identify_outliers(Weight)
# dont get this
```


normality
```{r normality}
model  <- lm(Weight ~ Site*daylight*Depth_Stratum, data = BulkBiomass)
# Create a QQ plot of residuals
ggqqplot(residuals(model))
# Compute Shapiro-Wilk test of normality
shapiro_test(residuals(model))

# probs not quite normally distributed - should tranform
```
normality by groups
```{r shapiro test by groups}
BulkBiomass %>%
  group_by(Site, daylight, Depth_Stratum) %>%
  shapiro_test(Weight)
```



QQ test
```{r qqtest}
ggqqplot(BulkBiomass, "Weight", ggtheme = theme_bw()) +
  facet_grid(Site + daylight ~ Depth_Stratum, labeller = "label_both")
```

homgeneity
```{r levenes}
BulkBiomass %>% levene_test(Weight ~ Site*daylight*Depth_Stratum)
# not significant assume homogeneity
```

Anova
```{r anova}
bio.aov <-  BulkBiomass%>% anova_test(Weight ~ Depth_Stratum*daylight*Site)
bio.aov
```
